<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Yuki-r Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Yuki-r Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Yuki">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Yuki-r Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yuki-r Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-30 12:30:30" itemprop="dateCreated datePublished" datetime="2021-03-30T12:30:30+08:00">2021-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-31 10:13:07" itemprop="dateModified" datetime="2021-03-31T10:13:07+08:00">2021-03-31</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h1><h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><h2 id="双指针"><a href="#双指针" class="headerlink" title="双指针"></a>双指针</h2><h2 id="滑动窗口"><a href="#滑动窗口" class="headerlink" title="滑动窗口"></a>滑动窗口</h2><blockquote>
<p>运用在数组或者字符串中，滑动窗口算法在一个特定大小的字符串或数组上进行操作，而不在整个字符串和数组上操作。</p>
</blockquote>
<h4 id="算法思路"><a href="#算法思路" class="headerlink" title="算法思路"></a>算法思路</h4><ol>
<li>在字符串中使用左右指针，初始化 left = right = 0，把索引闭区间 [left，right]称为一个窗口；</li>
<li>在符合要求的情况下不断向右移动 right 指针，不符合规则时停下；</li>
<li>停止移动 right 指针，此时需要移动 left 指针 直至窗口中的字符串再次符合要求；</li>
<li>重复 2、3步骤，right 指针到达字符串末尾即为终止条件；</li>
</ol>
<h2 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h2><blockquote>
<p>适用于找出一个数组中第k个大的值的情况，创建一个小顶堆，里面维护k个数，当遍历完数组的全部元素后，小顶堆队列的头元素就是第k大的值。</p>
<p>空间复杂度O(1),时间复杂度O（N log k）</p>
<p>使用类：PriorityQueue</p>
</blockquote>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210330231625.png"></p>
<h3 id="1-快速排序"><a href="#1-快速排序" class="headerlink" title="1.快速排序"></a>1.快速排序</h3><blockquote>
<p>主要思想：通过划分将待排序的序列分成前后两部分，其中前一部分的数据都比后一部分的数据要小，然后再递归调用函数对两部分的序列分别进行快速排序，以此使整个序列达到有序。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;快速排序</span><br><span class="line"> public void quicklySort(int i,int j,int[] nums) &#123;</span><br><span class="line"> &#x2F;&#x2F;左边界需要小于右边界</span><br><span class="line">    if(i&lt;j)&#123;</span><br><span class="line">    &#x2F;&#x2F;设置左边界，右边界，基准值默认为左边界对应的值</span><br><span class="line">        int left &#x3D; i,right &#x3D; j,pivot &#x3D; nums[left];</span><br><span class="line">        &#x2F;&#x2F;循环条件，左边界小于右边界， 当左边界&#x3D;右边界时表示此轮排序已结束</span><br><span class="line">        while(left&lt;right)&#123;</span><br><span class="line">        &#x2F;&#x2F;右指针往左移</span><br><span class="line">            while(left&lt;right&amp;&amp;nums[right]&gt;&#x3D;pivot)&#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;将右指针的值填入左指针的值，右指针的值为一个坑</span><br><span class="line">            if(left&lt;right) nums[left] &#x3D; nums[right];</span><br><span class="line">            &#x2F;&#x2F;左指针左移</span><br><span class="line">            while(left&lt;right&amp;&amp;nums[left]&lt;pivot)&#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            &#x2F;&#x2F;将左指针的值填入右指针的坑中，现在左指针是一个坑</span><br><span class="line">            if(left&lt;right) nums[right] &#x3D; nums[left];</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;遍历结束，把基准值填入最后一个坑中</span><br><span class="line">        nums[left] &#x3D; pivot;</span><br><span class="line">        &#x2F;&#x2F;递归左区间</span><br><span class="line">        quicklySort(i,left-1,nums);</span><br><span class="line">        &#x2F;&#x2F;递归右区间</span><br><span class="line">        quicklySort(left+1,j,nums);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-冒泡排序"><a href="#2-冒泡排序" class="headerlink" title="2. 冒泡排序"></a>2. 冒泡排序</h3><blockquote>
<p>思想</p>
<ul>
<li>比较相邻的元素。如果第一个比第二个大，就交换这两个的位置。</li>
<li>对每一相邻元素，重复执行上一步操作，最后一个元素会是最大的元素。</li>
<li>对所有元素，执行12步操作，最后一个元素不用。</li>
<li>遍历结束即排序完成。</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;冒泡排序</span><br><span class="line">   void bubbleSort(int[] nums)&#123;</span><br><span class="line">   	&#x2F;&#x2F;第一层遍历，记录已排序的元素的长度，排序完的元素不需要再比较</span><br><span class="line">      for (int i &#x3D; 0; i &lt; nums.length; i++)&#123;</span><br><span class="line">      		&#x2F;&#x2F;第二层遍历，开始比对相邻的元素大小，交换顺序，一次循环结束之后会把当前最大值放置数组末尾。</span><br><span class="line">           for (int j &#x3D; 0; j &lt; nums.length-1-i; j++)&#123;</span><br><span class="line">           	&#x2F;&#x2F;交换</span><br><span class="line">               if (nums[j]&gt;nums[j+1])&#123;</span><br><span class="line">                   int temp &#x3D; nums[j];</span><br><span class="line">                   nums[j] &#x3D; nums[j+1];</span><br><span class="line">                   nums[j+1] &#x3D; temp;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-直接插入排序"><a href="#3-直接插入排序" class="headerlink" title="3.直接插入排序"></a>3.直接插入排序</h3><blockquote>
<p>思想：将数组中的所有元素依次跟前面已经排好的元素相比较，如果比前面的元素小，则进行交换，直到找到合适的位置。</p>
<p>步骤：</p>
<ol>
<li>从第一个元素开始，该元素可以认为已经被排序</li>
<li>取出下一个元素，在已经排序的元素序列中从后向前扫描</li>
<li>如果已排序的元素大于新元素，将该元素移到下一个位置</li>
<li>重复步骤3，直到找到已排序的元素小于或等于新元素的位置</li>
<li>将新元素插入到该位置后</li>
<li>重复2-5步骤</li>
</ol>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;直接插入排序</span><br><span class="line"> void addSort(int[] nums)&#123;</span><br><span class="line">     if (nums&#x3D;&#x3D;null||nums.length &#x3D;&#x3D;0) return;</span><br><span class="line">     &#x2F;&#x2F;遍历全部元素</span><br><span class="line">     for (int i &#x3D; 1; i &lt; nums.length; i++)&#123;</span><br><span class="line">         int j &#x3D; i-1 ;   &#x2F;&#x2F;j为当前元素的前一个下标</span><br><span class="line">         int temp &#x3D; nums[i]; &#x2F;&#x2F;记录当前元素，移位的过程会覆盖</span><br><span class="line">         &#x2F;&#x2F;如果当前插入的值比前一个值小，前一个值后移，把插入的放入空位中</span><br><span class="line">         while(j&gt;&#x3D;0&amp;&amp;temp&lt;nums[j])&#123;</span><br><span class="line">             nums[j+1] &#x3D; nums[j];</span><br><span class="line">             j--;</span><br><span class="line">         &#125;</span><br><span class="line">         nums[j+1] &#x3D; temp;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/%E9%A2%98%E8%A7%A3/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-03-30 00:19:20 / 修改时间：16:33:23" itemprop="dateCreated datePublished" datetime="2021-03-30T00:19:20+08:00">2021-03-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h1><h2 id="一、链表"><a href="#一、链表" class="headerlink" title="一、链表"></a>一、链表</h2><h3 id="1-反转链表"><a href="#1-反转链表" class="headerlink" title="1.反转链表"></a>1.反转链表</h3><ul>
<li>迭代：设置前后指针保存当前节点的前后节点，使用While循环把当前节点的next指针指向前一个节点,移动指针。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ListNode curr &#x3D; head;  &#x2F;&#x2F;当前节点</span><br><span class="line">   ListNode prv &#x3D; null; &#x2F;&#x2F;存储上一个节点</span><br><span class="line">   while(curr!&#x3D;null)&#123;  &#x2F;&#x2F;遍历链表</span><br><span class="line">       ListNode next &#x3D; curr.next;  &#x2F;&#x2F;存放当前节点的下一个节点</span><br><span class="line">       curr.next &#x3D; prv;  &#x2F;&#x2F;把当前节点的指针指向前一个节点</span><br><span class="line">       prv  &#x3D; curr; &#x2F;&#x2F; 把当前的节点</span><br><span class="line">       curr &#x3D; next ;</span><br><span class="line">   &#125;</span><br><span class="line">   return prv;</span><br></pre></td></tr></table></figure>

<ul>
<li>递归：递归三要素：<strong>①可以分解为两个子问题 ② 子问题求解方式相同 ③ 有最小子问题</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if(head&#x3D;&#x3D;null||head.next&#x3D;&#x3D;null)&#123; </span><br><span class="line">         return head;</span><br><span class="line">     &#125;</span><br><span class="line">     ListNode p  &#x3D; reverseList(head.next);</span><br><span class="line">     &#x2F;&#x2F;归的过程需要做的事</span><br><span class="line">     head.next.next &#x3D; head ;  &#x2F;&#x2F;归的过程开始反转</span><br><span class="line">     head.next &#x3D; null; &#x2F;&#x2F;当前节点的前节点置位null，考虑到头结点的情况</span><br><span class="line">     return p;&#x2F;&#x2F;归的过程返回的已反转链表的头结点</span><br></pre></td></tr></table></figure>

<h2 id="二、字符串"><a href="#二、字符串" class="headerlink" title="二、字符串"></a>二、字符串</h2><h3 id="1-无重复字符串的最长字符串"><a href="#1-无重复字符串的最长字符串" class="headerlink" title="1.无重复字符串的最长字符串"></a>1.无重复字符串的最长字符串</h3><ul>
<li>双指针：使用前后指针+HashSet保存最长字符串中的字符+记录最大长度的max值。使用两个while循环，第一个while循环用来移动前指针，判断前指针指向的元素是否与HashSet中存储的元素相同，若相同，使用第二个while循环把后指针移动到相同元素的后一位。当前指针移动到字符串最后的元素时，遍历结束。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">int prev &#x3D; 0,back &#x3D; 0;</span><br><span class="line">      HashSet&lt;Character&gt; hashSet &#x3D; new HashSet&lt;Character&gt;();</span><br><span class="line">      int max &#x3D; 0;</span><br><span class="line">      &#x2F;&#x2F;前指针到终点即为结束</span><br><span class="line">      while(prev&lt;&#x3D;s.length()-1)&#123;</span><br><span class="line">          if (!hashSet.contains(s.charAt(prev)))&#123;  &#x2F;&#x2F;当前元素与set中元素不同，前指针+1</span><br><span class="line">              hashSet.add(s.charAt(prev));</span><br><span class="line">              int temp &#x3D; prev-back+1;</span><br><span class="line">              max &#x3D; Math.max(temp,max);  &#x2F;&#x2F;保存最长的长度</span><br><span class="line">          &#125;else&#123;  &#x2F;&#x2F;当前元素与set中元素有相同的。back指针走到相同元素后</span><br><span class="line">              while(s.charAt(back)!&#x3D;s.charAt(prev))&#123;</span><br><span class="line">                  hashSet.remove(s.charAt(back));  &#x2F;&#x2F;移除set在相同元素前的元素</span><br><span class="line">                  back++;</span><br><span class="line">              &#125;</span><br><span class="line">              back++; &#x2F;&#x2F;越过相同元素</span><br><span class="line">          &#125;</span><br><span class="line">          prev++;</span><br><span class="line">      &#125;</span><br><span class="line">      return max;</span><br></pre></td></tr></table></figure>

<ul>
<li>滑动窗口</li>
</ul>
<p>使用左右指针，右指针往右移，并且把遍历到的字符和下标存入map中。出现与map中字符相同的元素就开始移动左指针，左指针有两个可能性：相同元素数组下标+1，上次的left指针下标。这里出现两种情况是因为map中相同的元素有可能不在最长字符串中了，记录最长字符串的长度。</p>
<p>举例：abba，当left指针指向了b，right指针指向了a，此时map中有与a相同的元素，数组下标是1。但是下标为0的a已经不在最长字符串中了，此时的最长字符串为“ba”所以此时left的值应该是上次left的值，即指向b的下标。</p>
<p>当 right 指针指向字符串的最后一个元素时，结束循环，返回字符串的长度。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;滑动窗口</span><br><span class="line">  int left &#x3D; 0,right&#x3D;0;</span><br><span class="line">  int max &#x3D; 0; &#x2F;&#x2F;返回的长度</span><br><span class="line">  HashMap&lt;Character,Integer&gt; map &#x3D; new  HashMap&lt;Character,Integer&gt;();</span><br><span class="line">  while (right&lt;s.length())&#123;</span><br><span class="line">      &#x2F;&#x2F;当map中没有与当前元素相同的值时，right右移</span><br><span class="line">    if (map.containsKey(s.charAt(right)))&#123;</span><br><span class="line">        &#x2F;&#x2F;当相同元素不在最长字符串中时left &#x3D; left</span><br><span class="line">        &#x2F;&#x2F;当相同元素在最长字符串中时，lef &#x3D;  get(s.charAt(right))+1</span><br><span class="line">         left &#x3D; Math.max(left,map.get(s.charAt(right))+1);</span><br><span class="line">     &#125;</span><br><span class="line">     &#x2F;&#x2F;把遍历到的每一个元素放入map中</span><br><span class="line">     map.put(s.charAt(right),right);</span><br><span class="line">     max &#x3D; Math.max(max,right - left +1);</span><br><span class="line">     right++;</span><br><span class="line">  &#125;</span><br><span class="line">  return max;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/06/JVM%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/06/JVM%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-06 02:48:30" itemprop="dateCreated datePublished" datetime="2021-03-06T02:48:30+08:00">2021-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-07 00:34:11" itemprop="dateModified" datetime="2021-03-07T00:34:11+08:00">2021-03-07</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JVM笔记"><a href="#JVM笔记" class="headerlink" title="JVM笔记"></a>JVM笔记</h1><h2 id="一、内存管理机制"><a href="#一、内存管理机制" class="headerlink" title="一、内存管理机制"></a>一、内存管理机制</h2><h3 id="1-1运行时数据区域"><a href="#1-1运行时数据区域" class="headerlink" title="1.1运行时数据区域"></a>1.1运行时数据区域</h3><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306004211.png"></p>
<h4 id="1-程序计数器"><a href="#1-程序计数器" class="headerlink" title="1. 程序计数器"></a>1. 程序计数器</h4><blockquote>
<p>作用：PC寄存器用来存储指向下一条指令的地址，也即将要执行的指令代码。由执行引擎读取下一条指令。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306004231.png"></p>
<h4 id="2-Java虚拟机栈"><a href="#2-Java虚拟机栈" class="headerlink" title="2. Java虚拟机栈"></a>2. Java虚拟机栈</h4><blockquote>
<p>作用：主管Java程序的运行，它保存方法的局部变量，部分结果，并参与方法的调用与返回。</p>
</blockquote>
<p>Q：栈中存储什么？</p>
<ul>
<li>每个线程都有自己的栈，栈中的数据都是以栈帧的格式存在</li>
<li>在这个线程上正在执行的每个方法都各自对应一个栈帧</li>
<li>栈帧是一个内存区块，是一个数据集，维系着方法执行过程中的各种信息。</li>
</ul>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306004332.png"></p>
<p>Q：栈帧的内部结构是什么？</p>
<p>栈帧中存储着： </p>
<ul>
<li>局部变量表 （定义一个数字数组，主要用于存储方法参数和定义在方法体内的局部变量）</li>
<li>操作数栈 （在方法执行过程中，根据字节码指令，往栈中写入数据或提取数据，即入栈/出栈）</li>
<li>动态链接（指向运行时常量池的方法引用）</li>
<li>方法返回地址</li>
<li>一些附加信息</li>
</ul>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306004412.png"></p>
<h4 id="3-本地方法栈"><a href="#3-本地方法栈" class="headerlink" title="3.本地方法栈"></a>3.本地方法栈</h4><blockquote>
<p>Java虚拟机栈用于管理Java方法的调用，而本地方法栈用于管理本地方法的调用。</p>
</blockquote>
<h4 id="4-Java-堆"><a href="#4-Java-堆" class="headerlink" title="4. Java 堆"></a>4. Java 堆</h4><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306004102.png" alt="堆空间细分"></p>
<h5 id="对象分配过程"><a href="#对象分配过程" class="headerlink" title="对象分配过程"></a>对象分配过程</h5><ol>
<li>new 的对象先放在Eden区，此区大小有限制。</li>
<li>当Eden区填满时，程序又需要创建对象，JVM 的垃圾回收器会对Eden进行垃圾回收（Minor GC），将Eden中不再被其他对象所引用的对象进行销毁，再加载新的对象放到Eden区。</li>
<li>将在Eden中存活的对象移动到Survivor 0区。</li>
<li>如果再触发垃圾回收，上次在Survivor 0区的对象还没有的被回收的话， 就会从 Survivor 0区放到 Survivor 1 区。</li>
<li>如果再经历一次垃圾回收，会重新由1-&gt;0 ,如此反复。</li>
<li>默认对象在0-&gt;1复制的此次数为15时可以放到养老区。</li>
<li>当养老区内存不足时，会触发Major GC。</li>
<li>若Major GC后仍内存不足，就会产生OOM异常。</li>
</ol>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306005515.png" alt="对象分配"></p>
<blockquote>
<p>内存分配策略</p>
<ul>
<li>优先分配到Eden</li>
<li>大对象直接分配到老年代</li>
<li>长期存活的对象分配到老年代</li>
<li>动态对象年龄判断</li>
<li>空间分配担保</li>
</ul>
</blockquote>
<p>补充： JVM 为每个线程分配了一个私有缓存区域（TLAB），包含在Eden空间中，避免多个线程操作同一个地址，使用TLAB可以避免一系列非线程安全问题。</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306010035.png" alt="对象分配过程TLAB"></p>
<p>Q：堆是分配对象的唯一选择吗？</p>
<blockquote>
<p>没有发生逃逸的对象，可以分配到栈上，随着方法执行的结束，栈空间就被移除。</p>
</blockquote>
<h4 id="5-方法区"><a href="#5-方法区" class="headerlink" title="5.方法区"></a>5.方法区</h4><blockquote>
<p>概念：方法区看作是一块独立于Java堆的内存空间。</p>
</blockquote>
<p>内部结构</p>
<blockquote>
<ul>
<li>类型信息</li>
<li>运行时常量池（常量池表用于存放编译期生成的各种字面量与符号引用，这部分内容将在类加载后存放到方法区的运行时常量池中）</li>
<li>静态变量</li>
<li>JIT代码缓存</li>
<li>域信息</li>
<li>方法信息</li>
</ul>
</blockquote>
<p>方法区的演进细节</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306010824.png"></p>
<p>Q：为什么要将永久代 (PermGen) 替换为元空间 (MetaSpace) 呢?</p>
<ul>
<li>整个永久代有一个 JVM 本身设置固定大小上限，无法进行调整，而元空间使用的是直接内存，受本机可用内存的限制，虽然元空间仍旧可能溢出，但是比原来出现的几率会更小。</li>
<li>元空间里面存放的是类的元数据，这样加载多少类的元数据就不由 <code>MaxPermSize</code> 控制了, 而由系统的实际可用空间来控制，这样能加载的类就更多了。</li>
<li>在 JDK8，合并 HotSpot 和 JRockit 的代码时, JRockit 从来没有一个叫永久代的东西, 合并之后就没有必要额外的设置这么一个永久代的地方了。</li>
</ul>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h2 id="二、GC-（垃圾回收）机制"><a href="#二、GC-（垃圾回收）机制" class="headerlink" title="二、GC （垃圾回收）机制"></a>二、GC （垃圾回收）机制</h2><p>Q1：什么是垃圾?</p>
<blockquote>
<p>垃圾是指在运行程序中没有被任何指针指向的对象，这个对象就是需要被回收的垃圾。</p>
</blockquote>
<p>Q2：为什么要进行垃圾回收？</p>
<blockquote>
<p>如果不及时对内存中的垃圾进行清理，那么，这些垃圾对象所占用的内存空间会一直保留到应用程序结束，被保留的空间无法被其他对象使用，甚至可能导致<strong>内存溢出</strong></p>
</blockquote>
<p>Q3：垃圾回收的区域？</p>
<ul>
<li>方法区</li>
<li>堆（工作重点）<ul>
<li>频繁收集年轻代</li>
<li>较少收集养老代</li>
<li>基本不动元空间</li>
</ul>
</li>
</ul>
<h3 id="2-1垃圾回收相关算法"><a href="#2-1垃圾回收相关算法" class="headerlink" title="2.1垃圾回收相关算法"></a>2.1垃圾回收相关算法</h3><h5 id="1-标记阶段（判断对象存活）"><a href="#1-标记阶段（判断对象存活）" class="headerlink" title="1.标记阶段（判断对象存活）"></a>1.标记阶段（判断对象存活）</h5><p>a. 引用计数算法</p>
<blockquote>
<p>原理：对每个对象保存一个整形的引用计数器属性。用于记录对象被引用的情况。</p>
<p>优点：实现简单，垃圾对象便于辨识；判定效率高，回收没有延迟性。</p>
<p>缺点： </p>
<ul>
<li>需要单独的字段存储计数器，这样的做法增加了存储空间的开销</li>
<li>每次赋值都需要更新计数器，伴随着加法和减法操作，增加了时间开销。</li>
<li><strong>无法处理循环引用问题</strong></li>
</ul>
<p>在C++中，用弱引用可以解决无法处理循环引用问题。</p>
</blockquote>
<p>b.可达性分析算法</p>
<blockquote>
<p>原理：</p>
<ul>
<li>以根对象集合（GC Roots）为起始点，按照从上至下的方式<strong>搜索被根对象集合所连接的目标对象是否可达</strong>。</li>
<li>使用可达性分析算法后，内存中的存活对象都会被根对象集合直接或间接连接着，搜索走过的路径称为<strong>引用链</strong></li>
<li>如果目标对象没有任何引用链相连，则是不可达的，就意味着该对象已经死亡，可以标记为对象。</li>
<li>在可达性分析算法中，只有被根对象集合直接或者间接连接的对象才是存活对象。</li>
</ul>
</blockquote>
<p>Q： GC Roots 是什么元素组成的？</p>
<ul>
<li>虚拟机栈中引用的对象</li>
<li>本地方法栈内JNI（本地方法）引用的对象</li>
<li>方法区中类静态属性引用的对象，如Java类的引用类型静态变量</li>
<li>方法区中常量引用的对象，如字符串常量池里的引用</li>
<li>所有被同步锁synchronized持有的对象</li>
<li>Java虚拟机内部的引用</li>
<li>反映java虚拟机内部情况的JMXBean、JVMTI中注册的回调，本地代码缓存等。</li>
</ul>
<p>补充：除了这些固定的GC Roots集合以外，根据用户所选用的垃圾收集器以及当前回收的内存区域不同，还可以有其他对象“临时性”地加入，共同构成完整GC Roots集合。</p>
<h5 id="2-清除阶段（区分内存存活对象和死亡对象后，GC接下来的任务就是执行垃圾回收，释放无用对象所占用的内存空间）"><a href="#2-清除阶段（区分内存存活对象和死亡对象后，GC接下来的任务就是执行垃圾回收，释放无用对象所占用的内存空间）" class="headerlink" title="2. 清除阶段（区分内存存活对象和死亡对象后，GC接下来的任务就是执行垃圾回收，释放无用对象所占用的内存空间）"></a>2. 清除阶段（区分内存存活对象和死亡对象后，GC接下来的任务就是执行垃圾回收，释放无用对象所占用的内存空间）</h5><p>a.标记-清除算法</p>
<blockquote>
<p>过程：</p>
<ul>
<li>标记：Collector从引用根节点开始遍历，标记所有被引用的对象。</li>
<li>清除：Collector对堆内存从头到尾进行线性的遍历，回收没有被标记为可达的对象。</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306013643.png" alt="标记-清除算法"></p>
<p>缺点：</p>
<ul>
<li>效率不算高</li>
<li>进行GC时，需要停止整个应用程序（STW），导致用户体验差</li>
<li>这种方式清理出来的空闲内存是不连续的，产生内存碎片，需要维护一个空闲列表</li>
</ul>
<p>b.复制算法</p>
<blockquote>
<p>思想：将活着的内存空间分为两块，每次只使用其中一块，在垃圾回收时将正在使用的内存中的存活对象复制到未被使用的内存块中，之后清除正在使用的内存块中的所有对象，交换两个内存的角色，最后完成垃圾回收。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306014012.png" alt="复制算法"></p>
<p>优点：</p>
<ul>
<li>没有标记和清除过程，实现简单，运行高效</li>
<li>复制过去以后保证空间的连续性，不会出现“碎片”问题</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要两倍的内存空间</li>
<li>复制意味着GC需要维护region之间对象引用关系，内存占用和时间开销大</li>
</ul>
<blockquote>
<p> 补充：年轻代适合复制算法，因为年轻代一般存活对象少，复制的数量少。</p>
</blockquote>
<p>c.标记压缩算法</p>
<blockquote>
<p>标记：Collector从引用根节点开始遍历，标记所有被引用的对象。</p>
<p>压缩：将所有存活的对象压缩到内存的一端，按顺序排放，之后清理边界外所有的空间。</p>
<p>也叫 标记-清除-压缩 算法。</p>
</blockquote>
<p>优点：</p>
<ul>
<li>消除了标记-清除算法中内存区域分散的缺点。</li>
<li>消除了复制算法中，内存减半的高额代价。</li>
</ul>
<p>缺点：</p>
<ul>
<li>效率低于复制算法。</li>
<li>移动对象的同时，如果对象被其他对象引用，则还需要调整引用的地址。</li>
<li>移动过程中，需要全程暂停用户应用程序（STW）。</li>
</ul>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306014832.png" alt="算法对比"></p>
<p>d.分代收集算法</p>
<blockquote>
<p>目前几乎所有的GC都是采用分代收集算法执行垃圾回收的。</p>
</blockquote>
<p>在HotSpot中</p>
<ul>
<li>年轻代（复制算法）</li>
<li>老年代（标记清除/标记清除与标记压缩混合实现）</li>
</ul>
<p>e.增量收集算法</p>
<blockquote>
<p>思想：垃圾收集线程只收集一小片区域的内存空间，接着切换到应用程序线程。依次反复，直至垃圾收集完成。</p>
</blockquote>
<p>缺点：因为线程切换和上下文转换的消耗，会使得垃圾回收的总体成本上升，<strong>造成系统吞吐量的下降</strong>。</p>
<p>f.分区算法</p>
<blockquote>
<p>思想：将整个堆空间划分成连续的不同小区间，每个小区间都能独立使用，独立回收。可以控制一次回收多少个小区间。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306015517.png" alt="分区算法"></p>
<h3 id="2-2-内存溢出（OOM）和内存泄漏"><a href="#2-2-内存溢出（OOM）和内存泄漏" class="headerlink" title="2.2 内存溢出（OOM）和内存泄漏"></a>2.2 内存溢出（OOM）和内存泄漏</h3><p>Q1：内存溢出的原因？</p>
<ul>
<li>Java虚拟机的堆内存设置不够</li>
<li>代码中创建了大量大对象，并且长时间不能被垃圾收集器收集（存在被引用）</li>
</ul>
<p>Q2：内存泄漏是什么？</p>
<blockquote>
<p>严格来说，只有对象不会再被程序用到，但是GC又不能回收他们的情况，才叫内存泄漏。</p>
<p>但实际情况很多时候一些不太好的实践会导致对象的生命周期变得很长甚至导致OOM，也可以叫做宽泛意义上的“内存泄漏”。</p>
</blockquote>
<p>举例：</p>
<ol>
<li>单例模式</li>
</ol>
<p>单例的生命周期和应用程序一样长，所以单例程序中，如果持有对外部对象的引用的话，那么这个外部对象是不能被回收的，则会导致内存泄漏的产生。</p>
<h3 id="2-3-再谈引用"><a href="#2-3-再谈引用" class="headerlink" title="2.3 再谈引用"></a>2.3 再谈引用</h3><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306020232.png" alt="四种引用"></p>
<p>补充：</p>
<blockquote>
<ul>
<li><p>强引用可以直接访问目标对象</p>
</li>
<li><p>强引用所指向的对象在任何时候都不会被系统回收（就算出现OOM也不会）</p>
</li>
<li><p>强引用可能会导致内存泄漏</p>
</li>
</ul>
</blockquote>
<h3 id="2-4-垃圾回收器"><a href="#2-4-垃圾回收器" class="headerlink" title="2.4 垃圾回收器"></a>2.4 垃圾回收器</h3><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306021903.png" alt="垃圾收集器"></p>
<ol>
<li>Serial回收器：串行回收</li>
</ol>
<blockquote>
<p>特点：采用复制算法、串行回收和STW机制，用于年轻代垃圾回收。</p>
<p>Serial Old 用于老年代回收，采用串行回收和STW机制，标记压缩算法。</p>
</blockquote>
<p>优势：简单高效，适用于单cpu环境。</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306022227.png" alt="工作流程"></p>
<ol start="2">
<li>ParNew回收器：并行回收</li>
</ol>
<blockquote>
<p>特点：与Serial回收器的区别是，一个是并行，一个是串行，也是采用<strong>复制算法，STW机制</strong>。</p>
<p>老年代回收使用Serial Old 或者CMS配合。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306022208.png" alt="工作流程"></p>
<ol start="3">
<li>Parallel回收器：吞吐量优先</li>
</ol>
<blockquote>
<p>特点：采用复制算法、并行回收和STW机制。可以控制吞吐量大小，这是与ParNew的重要区别。</p>
<p>Parallel Old采用 标记-压缩算法，并行回收和STW机制。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306022137.png" alt="工作流程"></p>
<ol start="4">
<li>CMS回收器：低延迟</li>
</ol>
<blockquote>
<p>特点：采用标记-清除算法，STW机制，是老年代的收集器，不能与Parallel配合工作，年轻代只能选择ParNew或者Serial收集器中的一个。</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306022114.png" alt="工作流程"></p>
<ul>
<li>初始标记阶段：STW，任务仅仅是标记出GC Roots能直接关联到的对象，速度非常快。</li>
<li>并发标记：从GC Roots的直接关联对象开始遍历整个对象图的过程，耗时长，但不需要停顿用户线程，垃圾收集线程与用户线程并发运行。</li>
<li>重新标记：修正并发标记期间，因用户程序继续运作而导致标记产生变动的那一部分对象的标记记录，停顿事件比初始标记稍长，但远比并发标记阶段时间短。</li>
<li>并发清除：清除除掉标记阶段判断的已经死亡的对象，释放内存空间，与用户线程并发。</li>
</ul>
<p>Q：为什么CMS不把清除算法换成清除压缩算法以消除内存碎片的影响？</p>
<blockquote>
<p>并发运行的环境下，标记压缩算法会更改对象的引用地址，用户线程会受到影响。</p>
</blockquote>
<p>CMS缺点：</p>
<ul>
<li>会产生内存碎片</li>
<li>CMS收集器对CPU资源非常敏感</li>
<li>CMS收集器无法处理浮动垃圾</li>
</ul>
<ol start="5">
<li>G1回收器：区域化分代式</li>
</ol>
<blockquote>
<p>G1跟踪各个Region里面堆积的价值大小（回收所获得的控件大小以及回收所需要的经验值），在后台维护一个优先列表，每次根据允许的收集时间，优先回收价值最大的Region。</p>
<p>G1使用了全新的分区算法，有以下特点：</p>
<ul>
<li>并行与并发</li>
<li>分代收集</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306023314.png"></p>
<p>G1工作主要包括以下三个环节</p>
<ul>
<li>年轻代GC</li>
<li>老年代并发标记过程</li>
<li>混合回收</li>
</ul>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306023452.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306023936.png" alt="G1回收过程一：年轻代GC"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306023903.png" alt="G1回收过程二：并发标记过程"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306023821.png" alt="G1回收过程三：混合回收"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306024012.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306024028.png" alt="G1回收可选的过程四：Full GC"></p>
<h2 id="三、类加载机制"><a href="#三、类加载机制" class="headerlink" title="三、类加载机制"></a>三、类加载机制</h2><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306024253.png" alt="类加载的生命周期"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20210306024326.png"></p>
<h3 id="类的加载过程"><a href="#类的加载过程" class="headerlink" title="类的加载过程"></a>类的加载过程</h3><h4 id="1-加载"><a href="#1-加载" class="headerlink" title="1. 加载"></a>1. 加载</h4><ul>
<li>通过类的完全限定名称获取定义该类的二进制字节流。（可以有各种来源）</li>
<li>将该字节流表示的静态存储结构转换为方法区的运行时存储结构。</li>
<li>在内存中生成一个代表该类的 Class 对象，作为方法区中该类各种数据的访问入口。</li>
</ul>
<h4 id="2-验证"><a href="#2-验证" class="headerlink" title="2. 验证"></a>2. 验证</h4><p>确保 Class 文件的字节流中包含的信息符合当前虚拟机的要求，并且不会危害虚拟机自身的安全。</p>
<p>实例变量不会在这阶段分配内存，它会在对象实例化时随着对象一起被分配在堆中。应该注意到，实例化不是类加载的一个过程，类加载发生在所有实例化操作之前，并且类加载只进行一次，实例化可以进行多次。</p>
<h4 id="3-准备"><a href="#3-准备" class="headerlink" title="3. 准备"></a>3. 准备</h4><p>类变量是被 static 修饰的变量，准备阶段为类变量分配内存并设置初始值，使用的是方法区的内存。</p>
<h4 id="4-解析"><a href="#4-解析" class="headerlink" title="4. 解析"></a>4. 解析</h4><p>将常量池的符号引用替换为直接引用的过程。</p>
<p>其中解析过程在某些情况下可以在初始化阶段之后再开始，这是为了支持 Java 的动态绑定。</p>
<h4 id="5-初始化"><a href="#5-初始化" class="headerlink" title="5. 初始化"></a>5. 初始化</h4><p>初始化阶段才真正开始执行类中定义的 Java 程序代码。初始化阶段是虚拟机执行类构造器 <code>&lt;clinit\&gt;()</code> 方法的过程。在准备阶段，类变量已经赋过一次系统要求的初始值，而在初始化阶段，根据程序员通过程序制定的主观计划去初始化类变量和其它资源。</p>
<p><clinit>() 是由编译器自动收集类中所有类变量的赋值动作和静态语句块中的语句合并产生的，编译器收集的顺序由语句在源文件中出现的顺序决定。特别注意的是，静态语句块只能访问到定义在它之前的类变量，定义在它之后的类变量只能赋值，不能访问。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/18/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-18 22:59:02" itemprop="dateCreated datePublished" datetime="2020-11-18T22:59:02+08:00">2020-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-12-26 23:53:47" itemprop="dateModified" datetime="2020-12-26T23:53:47+08:00">2020-12-26</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一章-概述"><a href="#第一章-概述" class="headerlink" title="第一章 概述"></a>第一章 概述</h1><!----->

<ol>
<li><strong>计算机网络安全的概念是什么？网络安全有哪几个特征？各特征的含义是什么？</strong></li>
</ol>
<p>答：网络安全：指网络系统的软硬件以及系统中存储和传输的数据受到保护，不因偶然的或恶意的原因而遭到破坏、更改、泄露，网络系统连续可靠正常地运行，网络服务不中断。</p>
<p>网络安全的特征(属性)：</p>
<ul>
<li><p>机密性。保证信息与信息系统不被非授权的用户、实体或过程所获取与使用。</p>
</li>
<li><p>完整性。信息在存储或传输时不被破坏、修改，或不发生信息包丢失、乱序等。</p>
</li>
<li><p>可用性。信息在信息系统可被授权实体正常访问的特性，即授权实体在需要时能够存取所需信息。</p>
</li>
<li><p>可控性。对信息的此处与传播具有完全的控制能力，可以控制信息的流向和行为方式。</p>
</li>
<li><p>真实性。也就是可靠性，指信息的可用度，包括信息的完整性、准确性和发送人身份真实性等方面，它也是信息安全性的基本要素。</p>
</li>
</ul>
<ol start="2">
<li><p><strong>OSI的安全服务和安全机制都有哪几项？安全机制和安全服务是什么关系？</strong></p>
<p>答：OSI的5大类安全服务：鉴别服务、访问控制、数据完整性、数据保密性、不可否认性服务；</p>
</li>
</ol>
<p>OSI的8类特定的安全机制：加密、数字签名、访问控制、数据完整性、鉴别交换、信息流填充、路由控制、公证机制</p>
<p>OSI的5种通用的安全机制：可信功能、安全标签、事件检侧、安全审计跟踪、安全恢复。</p>
<p>安全服务通过安全机制来实现安全策略。</p>
<ol start="3">
<li><strong>什么是网络安全策略？主要包括哪几个方面的策略？</strong></li>
</ol>
<p>答：网络安全策略是网络安全系统的灵魂与核心，是在一个特定的环境里为保证提供一定级别的安全保护所必须遵守的规则集合。</p>
<p>网络安全策略主要包括5个方面：物理安全策略、访问控制策略、防火墙控制策略、信息加密策略、网络安全、管理策略。</p>
<ol start="4">
<li><strong>网络安全体系包括哪几个部分，各部分又由哪些方面组成？</strong></li>
</ol>
<p>答：网络安全体系包括三个组成部分：</p>
<p>网络安全技术体系：物理安全、计算机系统平台安全、通信安全、应用系统安全</p>
<p>网络安全组织体系：国家级、地方</p>
<p>网络安全管理体系：法律、制度、培训管理</p>
<h1 id="第二章-密码学"><a href="#第二章-密码学" class="headerlink" title="第二章 密码学"></a>第二章 密码学</h1><ol>
<li>密码体制五元组是什么?</li>
</ol>
<p>答：明文空间/P，密文空间/C，密钥空间/K，加密算法/E，解密算法/D。</p>
<ol start="2">
<li>从技术上说，一个密码体制的安全性取决于使用的什么的强度？</li>
</ol>
<p>答：密码算法。</p>
<h1 id="第三章-消息鉴别与数字签名"><a href="#第三章-消息鉴别与数字签名" class="headerlink" title="第三章 消息鉴别与数字签名"></a>第三章 消息鉴别与数字签名</h1><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201119175733.png"></p>
<ol>
<li>根据鉴别符的生成方式，鉴别函数可以分为哪几类？各自有什么特点？</li>
</ol>
<p>答：根据鉴别符的生成方式，鉴别函数可以分成以下几类：</p>
<p>1）基于消息加密方式的鉴别：以整个消息的密文作为鉴别符。此方法需要对整个消息进行加密，且要求消息具有一定的结构或格式。</p>
<p>2）基于消息鉴别码（MAC）的鉴别方式：发送方利用公开函数+密钥产生一个固定长度的值作为鉴别标识，并与消息一同发送。此方法需要专门的消息鉴别函数。</p>
<p>3）基于Hash函数的鉴别方式：采用hash函数将任意长度的消息映射为一个定长的散列值，以此散列值为鉴别码。</p>
<p>此方法必须与加密结合起来才具有安全性，此方法中哈希函数和加密算法都可选现成的函数，较易实现。</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201118173248.png"></p>
<h1 id="第四章-身份认证"><a href="#第四章-身份认证" class="headerlink" title="第四章 身份认证"></a>第四章 身份认证</h1><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201120213856.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201119101729.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201119180741.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201119180753.png"></p>
<h1 id="试卷"><a href="#试卷" class="headerlink" title="试卷"></a>试卷</h1><h2 id="网络安全复习题"><a href="#网络安全复习题" class="headerlink" title="网络安全复习题"></a>网络安全复习题</h2><ol>
<li>简述安全Hash函数要求满足的六个性质。</li>
</ol>
<blockquote>
<p>（1）H能够应用于任何大小的模块</p>
<p>（2）H产生固定长度的输出</p>
<p>（3）对于任何给定的数据块x，H都能够相对容易地计算出H(x)，这样就使得硬件和软件实现变得切实可行</p>
<p>（4）对于任何给定的值h来说，寻找满足H(x) = h的数据块x，在计算上是不可行的，</p>
<p>（5）对于给定的数据块x来说，寻找满足H(y)=H(x)且y不等于x的数据块y，在计算上是不可行的</p>
</blockquote>
<ol start="2">
<li>请说明公钥证书的产生过程，以及验证公钥证书的方法。</li>
</ol>
<blockquote>
<p>公钥证书由公钥、公钥所有者的用户ID和可信的第三方（用户团体所信任的认证中心CA）签名的整数数据块组成。</p>
<p>1）产生过程：没有签名的证书，包括用户ID和用户公钥，复制两份，一份给CA签名，一份用来产生散列码，再用CA的私钥来加密散列码，构成签名。再把签名加在有CA签名的证书上。</p>
<p>2）验证：接收者利用CA的公钥进行签名解密，获得发送者的散列码。接收者再把得到的未经过签名的证书进行产生散列码，看得到的散列码与获得的散列码是否一样。</p>
</blockquote>
<ol start="3">
<li>目前用来验证用户身份的方法有哪几类？分别举例说明。</li>
</ol>
<blockquote>
<p>常见的身份认证方法：</p>
<ul>
<li><p>基于用户知道什么的身份认证：用户标识（ID）+口令</p>
</li>
<li><p>基于用户拥有什么的身份认证：令牌（磁卡）、智能卡。一次性口令</p>
</li>
<li><p>基于用户是谁的身份认证：</p>
<p>生理特征：指纹、视网膜、脸型、掌纹等</p>
<p>行为特征：声纹、手写签名等</p>
</li>
</ul>
</blockquote>
<ol start="4">
<li>什么是重放攻击？请回答<code>IPSec</code>是如何采用窗口机制抵御重放攻击的。</li>
</ol>
<blockquote>
<p>重放是指被动的捕获数据单元然后按照原来的顺序重新发送。</p>
<p>设定窗口大小为W，若报文序号在N-W的左边，则丢弃；若序号在窗口内，则接收，并将相应的槽标记；若报文序号大于N+1，则接收，标记槽并将窗口右移</p>
</blockquote>
<ol start="5">
<li>简述目前网络攻击的主要方式有哪些？</li>
</ol>
<blockquote>
<ul>
<li>利用系统缺陷</li>
<li>利用用户单薄的安全意识</li>
<li>内部用户的窃密，泄密和破坏</li>
<li>恶意代码</li>
<li>口令攻击和拒绝服务</li>
</ul>
</blockquote>
<ol start="6">
<li>请简述什么是置换算法和替代算法，并分别给出置换算法和替代算法的实例。</li>
</ol>
<blockquote>
<p>置换算法：明文和密文的字母保持相同，但是顺序打乱了。如：栅栏密码</p>
<p>替代算法：明文中的每一个符号被替换为密文中的另一个字符。如：凯撒密码</p>
</blockquote>
<ol start="7">
<li>请简要说明如何通过<code>RSA</code>算法进行消息认证。</li>
</ol>
<blockquote>
</blockquote>
<h3 id="三、综合题"><a href="#三、综合题" class="headerlink" title="三、综合题"></a>三、综合题</h3><ol>
<li><code>IPSec</code>和<code>IP</code>协议以及<code>VPN</code>的关系是什么？</li>
</ol>
<blockquote>
<p><code>IPSec</code>是一种由<code>IETF</code>设计的端到端的确保<code>IP</code>层通信安全的机制，不是一个单独的协议，而是一组协议。</p>
<p><code>IPSec</code>是随着<code>IPv6</code>的制定而产生的，后再也增加了对<code>IPv4</code>的支持，在前者中是必须支持的，在后者是可选的</p>
<p><code>IPSec</code>作为一个第三层隧道协议实现了<code>VPN</code>通信，可以为<code>IP</code>网络通信提供透明的安全服务，免遭窃听和篡改，保证数据的完整性和机密性，有效抵御网络攻        击，同时保持易用性。</p>
</blockquote>
<ol start="2">
<li>包过滤防火墙的过滤原理是什么？</li>
</ol>
<blockquote>
<p>​    包过滤防火墙也称分组过滤路由器，又叫网络层防火墙，因为它是工作在网络层的。路由器是一个网络层防火墙，因为包过滤是路由器的固有属性，它一般是通过检查单个包的地址、协议、端口等信息来决定是否允许此数据包通过，有静态和动态两种过滤方式。</p>
<p>​    这种防火墙可以提供内部信息以说明所通过的连接状态和一些数据流的内容，把判断的信息同规则表进行比较，在规则表中定义了各种规则来表名是否同意或拒绝包的通过。包过滤防火墙检查每一条规则直至发现包中的信息与某规则相符。如果没有一条规则能符合，防火墙会使用默认规则（丢弃该包）。在制定数据包过滤规则时，数据包是双向的。</p>
</blockquote>
<ol start="3">
<li><code>VPN</code>有哪三种类型？它们的特点和应用场合分别是什么？</li>
</ol>
<p>（1）远程接入<code>VPN</code></p>
<blockquote>
<ul>
<li>特点</li>
</ul>
<p>远程用户只需通过当地的<code>ISP</code>接入到Internet就可以和公司的<code>VPN</code>网关建立私有的隧道连接，并访问单位内部的资源</p>
<ul>
<li>应用场合</li>
</ul>
<p>单位内部人员在外部网络或家庭网络访问单位内部网络资源</p>
</blockquote>
<p>（2）内联网 <code>VPN</code></p>
<blockquote>
<ul>
<li>特点</li>
</ul>
<p>通过公用网络进行企业内部的互联，是传统专网或其他企业网的扩展或替代形式</p>
<ul>
<li>应用场合</li>
</ul>
<p>企事业机构的总部、分支机构、办事处或移动办公人员可以通过公有网络组成企业内部网络</p>
</blockquote>
<p>（3）外联网<code>VPN</code></p>
<blockquote>
<ul>
<li>特点</li>
</ul>
<p>一种网关对网关的<code>VPN</code>，但它需要有不同协议和设备之间的配合和不同的安全配置</p>
<ul>
<li>应用场合</li>
</ul>
<p>将企业网延伸至供应商、合作伙伴与客户处，在具有共同利益的不同企业间通过公网构筑<code>VPN</code>，使部分资源能够在不同的<code>VPN</code>用户间共享</p>
</blockquote>
<ol start="4">
<li>什么是基于主机的IDS、基于网络的IDS、分布式IDS？</li>
</ol>
<blockquote>
<ul>
<li>基于主机的入侵检测系统‘</li>
</ul>
<p>基于主机的IDS的输入数据来源于系统的审计日志，即在每个要保护的主机上运行一个代理程序，一般只能检测该主机上发生的入侵。它在重要的系统服务器、工作站或用户机器上运行，监视操作系统或系统事件级别的可疑活动（如尝试登陆失败）。此类系统需要定义清楚哪些是不合法的活动，然后把这种安全策略转换成入侵检测规则。</p>
<ul>
<li>基于网络的入侵检测系统</li>
</ul>
<p>基于网络的IDS的输入数据来源于网络的信息流，该类系统一般被动地在网络上监听整个网段上的信息流，通过捕获网络数据包，进行分析，能够检测该网段上发生的网络入侵。</p>
<ul>
<li>分布式IDS</li>
</ul>
<p>一般由多个部件组成，分布在网络的各个部分，完成相应功能，分别进行数据采集，数据分析等。通过中心的控制部件进行数据汇总、分析、产生入侵警报等。在这种结构下，不仅可以检测到针对单独主机的入侵，同时也可以检测到针对整个网络上的主机的入侵。</p>
</blockquote>
<h2 id="复习课件"><a href="#复习课件" class="headerlink" title="复习课件"></a>复习课件</h2><h3 id="一、概述"><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h3><ol>
<li>网络安全的属性：<strong>机密性、可用性、完整性</strong>、可控性、不可否认性</li>
<li>网络系统基本模型的四个组成部分：加密系统（安全协议），抗恶意软件（AMS），入侵检测系统（IDS），防火墙</li>
<li><code>OSI</code>体系结构包括：</li>
</ol>
<ul>
<li>安全攻击<ul>
<li>被动攻击：信息收集和流量分析</li>
<li>主动攻击：伪装、重放、消息篡改和拒绝服务</li>
</ul>
</li>
<li>安全机制：加密、数字签名、访问控制、数据完整性、鉴别交换、信息流填充、路由控制、公证</li>
<li>安全服务：鉴别服务、访问控制服务、数据完整性服务、数据保密性服务、不可否认性服务</li>
</ul>
<ol start="4">
<li>网络安全策略：为保证提供一定级别的安全保护所必须要遵守的一系列法律、法规和措施的集合</li>
</ol>
<h2 id="二、密码学"><a href="#二、密码学" class="headerlink" title="二、密码学"></a>二、密码学</h2><h2 id="三、消息鉴别与数字签名"><a href="#三、消息鉴别与数字签名" class="headerlink" title="三、消息鉴别与数字签名"></a>三、消息鉴别与数字签名</h2><ol>
<li>鉴别：消息接收者对消息的验证，是一个证实接收的消息来自一个可信的源点且未被篡改的过程</li>
<li>根据鉴别符的生成方式，鉴别函数可以分为以下几类：</li>
</ol>
<ul>
<li>基于消息加密的鉴别</li>
</ul>
<p>以整个消息的密文作为鉴别符</p>
<ul>
<li>基于消息鉴别码（MAC）的鉴别</li>
</ul>
<p>发送方利用公开函数+密钥产生一个固定长度的值作为鉴别符，并与消息一同发送</p>
<blockquote>
<p>发送方采用一种类似加密的算法和密钥，根据消息的内容生成一个固定大小的小数据块，并加入到消息中，称为MAC。</p>
</blockquote>
<p>核心：类似加密算法的鉴别符生成算法</p>
<p>功能：接收者可以确信消息没有被改变、接收者可以确信消息来自发送者</p>
<ul>
<li>基于Hash函数的鉴别</li>
</ul>
<p>利用hash函数将任意长度的消息映射为一个定长的散列值，以此散列值为鉴别码</p>
<p>必须与加密结合起来才有安全性：对明文与散列值加密，或只对散列值加密</p>
<h3 id="四、身份认证"><a href="#四、身份认证" class="headerlink" title="四、身份认证"></a>四、身份认证</h3><ol>
<li><code>PKI</code>（公钥基础设施）：是为了公钥密码体制而建立的安全基础设施，用于签发和管理公钥证书</li>
</ol>
<h3 id="五、Internet安全"><a href="#五、Internet安全" class="headerlink" title="五、Internet安全"></a>五、Internet安全</h3><ol>
<li><code>IPsec</code>包括三个协议：AH，ESP，IKE</li>
</ol>
<blockquote>
<ul>
<li>认证头协议（AH）</li>
</ul>
<p>认证<code>IP</code>包的来源和完整性，用滑动窗口防御消息的重放攻击</p>
<ul>
<li>封装安全载荷协议（ESP）</li>
</ul>
<p>加密和认证<code>IP</code>包</p>
<ul>
<li>Internet密钥交换协议（IKE）用于通信双方协商密钥</li>
</ul>
<p>用于通信双方协商密钥，在使用AH和ESP之前，先要从源主机到目的主机建立一条网络层的逻辑连接，称为安全关联SA</p>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201123221219.png"></p>
<ol start="2">
<li><code>SSL</code>/<code>TLS</code>:传输层与网络层之间的协议，可以为高层数据传输提供端与端的安全服务</li>
</ol>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201123221845.png"></p>
<ol start="3">
<li><code>PGP</code>: 为电子邮件和文件存储提供了以下服务：认证、保密、压缩、电子邮件兼容性和分段。</li>
<li><code>PGP</code>消息的生成</li>
</ol>
<blockquote>
<ul>
<li><p>步骤1：签名消息</p>
<ol>
<li><p><code>PGP</code>以用户标识作为索引从发送方的私钥中取出选定的私钥，如果在命令中不提供用户标识，则取出私钥环中的第一个私钥</p>
</li>
<li><p><code>PGP</code>提示用户输入口令恢复私钥</p>
</li>
<li><p>创建消息的签名</p>
</li>
</ol>
</li>
<li><p>步骤2：加密消息</p>
<ol start="4">
<li><p><code>PGP</code>生成会话密钥并加密消息</p>
</li>
<li><p><code>PGP</code>用接收方的用户标识作为索引从公钥环中获得接收方的公钥</p>
</li>
<li><p>创建消息的会话密钥</p>
</li>
</ol>
</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201123225004.png"></p>
<ol start="5">
<li><code>PGP</code>消息的接收</li>
</ol>
<blockquote>
<ul>
<li>步骤1：解密消息<ol>
<li><code>PGP</code>用消息的会话密钥的密钥标识域作为索引从私钥环中获取接收方的私钥</li>
<li><code>PGP</code>提示用户输入口令恢复私钥</li>
<li><code>PGP</code>恢复会话密钥，解密消息</li>
</ol>
</li>
<li>步骤2：认证消息<ol start="4">
<li><code>PGP</code>用消息的签名密钥中包含的密钥标识从公钥环中获取发送方的公钥</li>
<li><code>PGP</code>恢复消息摘要</li>
<li><code>PGP</code>计算接收到的消息摘要，并将其恢复的消息摘要进行比较认证</li>
</ol>
</li>
</ul>
</blockquote>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201123230029.png"></p>
<h3 id="六、恶意代码"><a href="#六、恶意代码" class="headerlink" title="六、恶意代码"></a>六、恶意代码</h3><h3 id="七、防火墙"><a href="#七、防火墙" class="headerlink" title="七、防火墙"></a>七、防火墙</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/25/SunFlower%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/25/SunFlower%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">SunFlower源码解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-25 20:45:44" itemprop="dateCreated datePublished" datetime="2020-10-25T20:45:44+08:00">2020-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-27 21:17:53" itemprop="dateModified" datetime="2020-10-27T21:17:53+08:00">2020-10-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>如今使用Android JetPack组件的开发环境越来越成熟，Kotlin距离被官宣Android开发第一语言也已经过去2年了，我们有理由相信未来开发的主流就是使用JetPack架构组件开发。</p>
<p>那么怎样标准的使用JetPack去开发应用呢？</p>
<p>这个谷歌已经给我们设计好了模板，那就是<a target="_blank" rel="noopener" href="https://github.com/android/sunflower"><strong>sunflower</strong></a>项目。</p>
<p>只要我们学会了模板里面的用法，相信你离自己写一个Jetpack项目也不远了，</p>
<p>本文主要对项目的逻辑进行说明，便于读者更加高速的理解JetPack标准架构的开发。</p>
</blockquote>
<h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><h4 id="知识点储备"><a href="#知识点储备" class="headerlink" title="知识点储备"></a>知识点储备</h4><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025225813.png" alt="MVVM"></p>
<ul>
<li>语言：Kotlin</li>
<li>架构：MVVM</li>
<li>组件：ViewModel，LiveData，Databinding，Hilt，Room，WorkManager，Navigation</li>
</ul>
<blockquote>
<p>组件的用法详情建议看官方文档。</p>
</blockquote>
<h4 id="下载项目"><a href="#下载项目" class="headerlink" title="下载项目"></a>下载项目</h4><blockquote>
<p>在<a target="_blank" rel="noopener" href="https://github.com/android/sunflower">github传送</a>克隆或者下载zip包到本地上。</p>
</blockquote>
<p>下载完运行程序会有以下界面：</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025210453.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025210520.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025210532.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201026221028.png"></p>
<blockquote>
<p>注意：这个是一个RecycleView显示图片的界面，但是访问这个获取图片的api需要权限，这里是我们拉下来本地运行的，所以api没有权限访问不了，因此这个界面是空的。</p>
<p>捕捉异常：</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201026221306.png"></p>
<p>还要注意的一点是，这个fragment是在<code>PlantDetailFragment</code>里跳转过去的，因为这里设置了没有图片就隐藏跳转的按钮，只要把这一行代码删了就可以跳转到这个界面了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--    app:isGone&#x3D;&quot;@&#123;!viewModel.hasValidUnsplashKey()&#125;&quot;--&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="一、Layout篇"><a href="#一、Layout篇" class="headerlink" title="一、Layout篇"></a>一、Layout篇</h3><p>这是一个典型的单Activity多fragment界面的程序，用项目中的名称来说，这个项目只有一个GardenActivity，在GardenActivity上有多个4个fragment。</p>
<p>这是GardenActivity的布局代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;layout</span><br><span class="line">    xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;androidx.fragment.app.FragmentContainerView</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;nav_host&quot;</span><br><span class="line">        android:name&#x3D;&quot;androidx.navigation.fragment.NavHostFragment&quot;</span><br><span class="line">        android:layout_width&#x3D;&quot;match_parent&quot;</span><br><span class="line">        android:layout_height&#x3D;&quot;match_parent&quot;</span><br><span class="line">        app:defaultNavHost&#x3D;&quot;true&quot;</span><br><span class="line">        app:navGraph&#x3D;&quot;@navigation&#x2F;nav_garden&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;layout&gt;</span><br></pre></td></tr></table></figure>



<p>这里对fragment的操作的就涉及到了JetPack组件中的Navigation，Navigation将fragment联系在一起,这是Navigation的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;navigation xmlns:android&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res&#x2F;android&quot;</span><br><span class="line">    xmlns:app&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;apk&#x2F;res-auto&quot;</span><br><span class="line">    xmlns:tools&#x3D;&quot;http:&#x2F;&#x2F;schemas.android.com&#x2F;tools&quot;</span><br><span class="line">    app:startDestination&#x3D;&quot;@id&#x2F;view_pager_fragment&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;view_pager_fragment&quot;</span><br><span class="line">        android:name&#x3D;&quot;com.google.samples.apps.sunflower.HomeViewPagerFragment&quot;</span><br><span class="line">        tools:layout&#x3D;&quot;@layout&#x2F;fragment_view_pager&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;action</span><br><span class="line">                android:id&#x3D;&quot;@+id&#x2F;action_view_pager_fragment_to_plant_detail_fragment&quot;</span><br><span class="line">                app:destination&#x3D;&quot;@id&#x2F;plant_detail_fragment&quot;</span><br><span class="line">                app:enterAnim&#x3D;&quot;@anim&#x2F;slide_in_right&quot;</span><br><span class="line">                app:exitAnim&#x3D;&quot;@anim&#x2F;slide_out_left&quot;</span><br><span class="line">                app:popEnterAnim&#x3D;&quot;@anim&#x2F;slide_in_left&quot;</span><br><span class="line">                app:popExitAnim&#x3D;&quot;@anim&#x2F;slide_out_right&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;fragment&gt;</span><br><span class="line"></span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;plant_detail_fragment&quot;</span><br><span class="line">        android:name&#x3D;&quot;com.google.samples.apps.sunflower.PlantDetailFragment&quot;</span><br><span class="line">        android:label&#x3D;&quot;@string&#x2F;plant_details_title&quot;</span><br><span class="line">        tools:layout&#x3D;&quot;@layout&#x2F;fragment_plant_detail&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;action</span><br><span class="line">            android:id&#x3D;&quot;@+id&#x2F;action_plant_detail_fragment_to_gallery_fragment&quot;</span><br><span class="line">            app:destination&#x3D;&quot;@id&#x2F;gallery_fragment&quot;</span><br><span class="line">            app:enterAnim&#x3D;&quot;@anim&#x2F;slide_in_right&quot;</span><br><span class="line">            app:exitAnim&#x3D;&quot;@anim&#x2F;slide_out_left&quot;</span><br><span class="line">            app:popEnterAnim&#x3D;&quot;@anim&#x2F;slide_in_left&quot;</span><br><span class="line">            app:popExitAnim&#x3D;&quot;@anim&#x2F;slide_out_right&quot; &#x2F;&gt;</span><br><span class="line">        &lt;argument</span><br><span class="line">            android:name&#x3D;&quot;plantId&quot;</span><br><span class="line">            app:argType&#x3D;&quot;string&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;fragment&gt;</span><br><span class="line"></span><br><span class="line">    &lt;fragment</span><br><span class="line">        android:id&#x3D;&quot;@+id&#x2F;gallery_fragment&quot;</span><br><span class="line">        android:name&#x3D;&quot;com.google.samples.apps.sunflower.GalleryFragment&quot;</span><br><span class="line">        android:label&#x3D;&quot;@string&#x2F;plant_details_title&quot;</span><br><span class="line">        tools:layout&#x3D;&quot;@layout&#x2F;fragment_gallery&quot;&gt;</span><br><span class="line">        &lt;argument</span><br><span class="line">            android:name&#x3D;&quot;plantName&quot;</span><br><span class="line">            app:argType&#x3D;&quot;string&quot; &#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;fragment&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;navigation&gt;</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025211235.png" alt="Navigation视图"></p>
<p>到目前为止，这只是Activity的一个局部布局，完整的布局还是Toolbar+TabLayout+ViewPager2+fragment结构。这4个界面的关系就是下图所示</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025212741.png"></p>
<h2 id="二、Kotlin篇"><a href="#二、Kotlin篇" class="headerlink" title="二、Kotlin篇"></a>二、Kotlin篇</h2><blockquote>
<p>上面讲述了sunflower的基本布局，相信你对它的大致布局已经有了了解，在这一节中将讲述fragment中的代码功能。</p>
</blockquote>
<h4 id="2-1-PlantListFragment"><a href="#2-1-PlantListFragment" class="headerlink" title="2.1 PlantListFragment"></a>2.1 PlantListFragment</h4><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025210520.png"></p>
<blockquote>
<p>看到这个界面，你首先会想到什么？</p>
</blockquote>
<p>在这个界面中，就只有一个RecycleView，想到的当然是它访问网络获取数据显示到UI界面的流程。</p>
<p>思想跟使用 MVP+RxJava+Retrofit 组合是基本一致的，无非就是调用接口，获取数据，回调主线程更新UI。</p>
<p>接下来，让我们来看看它是怎么走完这个流程的。</p>
<blockquote>
<p>从哪个部分开始呢？UI？还是网络？</p>
</blockquote>
<p>我们需要先明确一个点，MVVM架构是数据驱动更新界面,而我们平时使用的MVP架构是UI驱动，也就是使用MVP时，我们是需要手动的更新UI，而在使用MVVM时，当数据改变时，UI会自动更新。</p>
<p>那么自然而然的，一切的源头都从数据的来源开始说起，这个时候，储备的知识点WorkManager要用上了，看代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class SeedDatabaseWorker(</span><br><span class="line">    context: Context,</span><br><span class="line">    workerParams: WorkerParameters</span><br><span class="line">) : CoroutineWorker(context, workerParams) &#123;  &#x2F;&#x2F;用 CoroutineWorker 处理线程  使用协程 运行默认的 Dispatcher（子线程）</span><br><span class="line">    override suspend fun doWork(): Result &#x3D; coroutineScope &#123;  &#x2F;&#x2F;doWork()是一个挂起函数,suspend 关键字声明挂起函数</span><br><span class="line">                                                            &#x2F;&#x2F; doWork() 方法在 WorkManager 提供的后台线程上同步运行</span><br><span class="line">        try &#123;</span><br><span class="line">            &#x2F;&#x2F;获取ApplicationContext，通过ApplicationContext获取AssetManager实例</span><br><span class="line">            &#x2F;&#x2F;调用AssetManager实例的open方法,打开并读取已与应用程序捆绑在一起的原始文件作为简单的字节流</span><br><span class="line">            applicationContext.assets.open(PLANT_DATA_FILENAME).use &#123; inputStream -&gt;</span><br><span class="line">                JsonReader(inputStream.reader()).use &#123; jsonReader -&gt;</span><br><span class="line">                    val plantType &#x3D; object : TypeToken&lt;List&lt;Plant&gt;&gt;() &#123;&#125;.type</span><br><span class="line">                    val plantList: List&lt;Plant&gt; &#x3D; Gson().fromJson(jsonReader, plantType) &#x2F;&#x2F;解析数据，放到List集合中，类型是Plant实体类</span><br><span class="line"></span><br><span class="line">                    val database &#x3D; AppDatabase.getInstance(applicationContext) &#x2F;&#x2F;创建数据库</span><br><span class="line">                    database.plantDao().insertAll(plantList) &#x2F;&#x2F;获取数据存放进数据库</span><br><span class="line"></span><br><span class="line">                    Result.success()  &#x2F;&#x2F;返回成功的结果</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125; catch (ex: Exception) &#123;</span><br><span class="line">            Log.e(TAG, &quot;Error seeding database&quot;, ex)</span><br><span class="line">            Result.failure()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    companion object &#123;</span><br><span class="line">        private const val TAG &#x3D; &quot;SeedDatabaseWorker&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里使用了WorkManager，则表示了它是一个后台任务。WorkManager配合Kotlin协程完成线程回调，这里注意一个点，这里资源的来源不是网络也不是数据库，而是调用了AssetManager实例获取本地的文件资源，位置如图所示：</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025230211.png"></p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025231205.png" alt="部分内容"></p>
<p>这里存放了一个json文件，通过<code>applicationContext.assets</code>获取AssetManager实例，在通过这个实例打开这个文件<code>open(PLANT_DATA_FILENAME)</code>，这里的<code>PLANT_DATA_FILENAME</code>常量也就是文件名，如图：</p>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201025230503.png"></p>
<p>获取成功后的数据又保存进了数据库，以便后续的调用。</p>
<blockquote>
<p> 这里的知识主要就是WorkManager使用，这部分代码就是要告诉你，WorkManager可以后台处理任务，具体到这个例子，就是后台加载了json文件的数据再存放进数据库里。</p>
</blockquote>
<hr>
<p>看完了上面的代码，发现数据不仅能从网络和数据库中获取，也能直接访问资源文件获取。接下来我们来看看我们使用最后的获取数据的方法——从网络层中获取。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">interface UnsplashService &#123;</span><br><span class="line"></span><br><span class="line">    @GET(&quot;search&#x2F;photos&quot;)</span><br><span class="line">    suspend fun searchPhotos(    &#x2F;&#x2F;挂起函数</span><br><span class="line">        @Query(&quot;query&quot;) query: String, &#x2F;&#x2F;访问地址的参数</span><br><span class="line">        @Query(&quot;page&quot;) page: Int,</span><br><span class="line">        @Query(&quot;per_page&quot;) perPage: Int,</span><br><span class="line">        @Query(&quot;client_id&quot;) clientId: String &#x3D; BuildConfig.UNSPLASH_ACCESS_KEY  &#x2F;&#x2F;若有id，这不为空，在界面显示图片</span><br><span class="line">                                                                                  &#x2F;&#x2F;为空时不显示点击图片的按钮，这个就是GalleryFragment中第一次运行按钮没显示出来的逻辑代码</span><br><span class="line">    ): UnsplashSearchResponse &#x2F;&#x2F;返回 UnsplashSearchResponse 对象</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        private const val BASE_URL &#x3D; &quot;https:&#x2F;&#x2F;api.unsplash.com&#x2F;&quot;</span><br><span class="line"></span><br><span class="line">        fun create(): UnsplashService &#123; &#x2F;&#x2F;返回一个UnsplashService实例</span><br><span class="line">            val logger &#x3D; HttpLoggingInterceptor().apply &#123; level &#x3D; Level.BASIC &#125;</span><br><span class="line"></span><br><span class="line">            val client &#x3D; OkHttpClient.Builder()</span><br><span class="line">                .addInterceptor(logger)</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">            return Retrofit.Builder()       &#x2F;&#x2F;设置Retrofit</span><br><span class="line">                .baseUrl(BASE_URL)</span><br><span class="line">                .client(client)</span><br><span class="line">                .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build()</span><br><span class="line">                .create(UnsplashService::class.java)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用过retrofit的读者不难看出，上面的<code>create()</code>方法其实就是对Retrofit的一个封装，不过我们平时用的都是传入一个ServiceClass参数，这里是直接传入这个方法中。接下来就可以使用<code>searchPhotos</code>方法去访问网络了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;图片来源</span><br><span class="line">class UnsplashPagingSource(</span><br><span class="line">    private val service: UnsplashService,</span><br><span class="line">    private val query: String</span><br><span class="line">) : PagingSource&lt;Int, UnsplashPhoto&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;load() 函数来从数据源获取分页数据，并返回加载好的数据和加载前后页的参数信息</span><br><span class="line">    override suspend fun load(params: LoadParams&lt;Int&gt;): LoadResult&lt;Int, UnsplashPhoto&gt; &#123;  &#x2F;&#x2F;返回对象为LoadResult类型，Int表示使用页码加载</span><br><span class="line">        val page &#x3D; params.key ?: UNSPLASH_STARTING_PAGE_INDEX &#x2F;&#x2F;params.key为空page就设置默认值1</span><br><span class="line">        return try &#123;</span><br><span class="line">            val response &#x3D; service.searchPhotos(query, page, params.loadSize) &#x2F;&#x2F;访问网络</span><br><span class="line">            val photos &#x3D; response.results &#x2F;&#x2F;赋值给对象</span><br><span class="line">            LoadResult.Page(                 &#x2F;&#x2F;设置网络上获取的 数据</span><br><span class="line">                data &#x3D; photos,  &#x2F;&#x2F;加载好的数据</span><br><span class="line">                prevKey &#x3D; if (page &#x3D;&#x3D; UNSPLASH_STARTING_PAGE_INDEX) null else page - 1, &#x2F;&#x2F;这一页的数据为空，查找上一页</span><br><span class="line">                nextKey &#x3D; if (page &#x3D;&#x3D; response.totalPages) null else page + 1  &#x2F;&#x2F;加载下一页的key 如果传null就说明到底了</span><br><span class="line">            )</span><br><span class="line">        &#125; catch (exception: Exception) &#123;</span><br><span class="line">            System.out.println(&quot;获取图片失败&quot;)</span><br><span class="line">            LoadResult.Error(exception)  &#x2F;&#x2F; 获取数据失败</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个类中，使用挂起函数<code>load(params: LoadParams&lt;Int&gt;)</code>去调用了<code>UnsplashService</code>类中的<code>searchPhotos(query, page, params.loadSize)</code></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/14/Retrofit%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/14/Retrofit%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Retrofit基本使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-14 17:48:10 / 修改时间：21:48:14" itemprop="dateCreated datePublished" datetime="2020-10-14T17:48:10+08:00">2020-10-14</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>​    <code>Retrofit</code>是Square公司开发的一款针对Android网络请求的框架,遵循Restful设计风格,底层基于OkHttp，获得许多使用者的好评，也是现在的主流网络请求框架，使用好各种框架有利于我们更快的实现项目，本文主要讲解Retrofit网络框架的使用以及各种注解的注释。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://square.github.io/retrofit/">Retrofit官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/square/retrofit">Retrofit Github</a></li>
</ul>
<p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201014213936.png" alt="目录"></p>
<h2 id="一、使用"><a href="#一、使用" class="headerlink" title="一、使用"></a>一、使用</h2><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201014175443.png" alt="具体使用"></p>
<blockquote>
<p>以下以访问词霸api为例，URL为“<a target="_blank" rel="noopener" href="http://fy.iciba.com/ajax.php?a=fy&amp;f=auto&amp;t=auto&amp;w=hello%20world%E2%80%9D">http://fy.iciba.com/ajax.php?a=fy&amp;f=auto&amp;t=auto&amp;w=hello%20world”</a></p>
</blockquote>
<h3 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1.添加依赖"></a>1.添加依赖</h3><ul>
<li>在app包下的<em>build.gradle</em>中</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    compile &#39;com.squareup.retrofit2:retrofit:2.1.0&#39;</span><br><span class="line">    &#x2F;&#x2F; Retrofit库</span><br><span class="line">    implementation &#39;com.squareup.retrofit2:converter-gson:2.1.0&#39; &#x2F;&#x2F;GSON解析</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>添加 网络权限</strong></li>
</ul>
<p>AndroidManifest.xml*</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-permission android:name&#x3D;&quot;android.permission.INTERNET&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-创建-接收服务器返回数据-的类"><a href="#2-创建-接收服务器返回数据-的类" class="headerlink" title="2.创建 接收服务器返回数据 的类"></a>2.创建 接收服务器返回数据 的类</h3><blockquote>
<p>使用GsonFormat生成对应的Java Bean类</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;:1,</span><br><span class="line">  &quot;content&quot;:&#123;</span><br><span class="line">    &quot;from&quot;:&quot;en&quot;,</span><br><span class="line">    &quot;to&quot;:&quot;zh-CN&quot;,</span><br><span class="line">    &quot;vendor&quot;:&quot;ciba&quot;,</span><br><span class="line">    &quot;out&quot;:&quot; 你好，世界&quot;,</span><br><span class="line">    &quot;ciba_use&quot;:&quot;来自机器翻译。&quot;,</span><br><span class="line">    &quot;ciba_out&quot;:&quot;&quot;,</span><br><span class="line">    &quot;err_no&quot;:0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">public class TranslationBean &#123;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * status : 1</span><br><span class="line">     * content : &#123;&quot;from&quot;:&quot;en&quot;,&quot;to&quot;:&quot;zh-CN&quot;,&quot;vendor&quot;:&quot;ciba&quot;,&quot;out&quot;:&quot; 你好，世界&quot;,&quot;ciba_use&quot;:&quot;来自机器翻译。&quot;,&quot;ciba_out&quot;:&quot;&quot;,&quot;err_no&quot;:0&#125;</span><br><span class="line">     *&#x2F;</span><br><span class="line"></span><br><span class="line">    private int status;</span><br><span class="line">    private ContentBean content;</span><br><span class="line"></span><br><span class="line">    public int getStatus() &#123;</span><br><span class="line">        return status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setStatus(int status) &#123;</span><br><span class="line">        this.status &#x3D; status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ContentBean getContent() &#123;</span><br><span class="line">        return content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setContent(ContentBean content) &#123;</span><br><span class="line">        this.content &#x3D; content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static class ContentBean &#123;</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * from : en</span><br><span class="line">         * to : zh-CN</span><br><span class="line">         * vendor : ciba</span><br><span class="line">         * out :  你好，世界</span><br><span class="line">         * ciba_use : 来自机器翻译。</span><br><span class="line">         * ciba_out :</span><br><span class="line">         * err_no : 0</span><br><span class="line">         *&#x2F;</span><br><span class="line"></span><br><span class="line">        private String from;</span><br><span class="line">        private String to;</span><br><span class="line">        private String vendor;</span><br><span class="line">        private String out;</span><br><span class="line">        private String ciba_use;</span><br><span class="line">        private String ciba_out;</span><br><span class="line">        private int err_no;</span><br><span class="line"></span><br><span class="line">        public String getFrom() &#123;</span><br><span class="line">            return from;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setFrom(String from) &#123;</span><br><span class="line">            this.from &#x3D; from;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getTo() &#123;</span><br><span class="line">            return to;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setTo(String to) &#123;</span><br><span class="line">            this.to &#x3D; to;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getVendor() &#123;</span><br><span class="line">            return vendor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setVendor(String vendor) &#123;</span><br><span class="line">            this.vendor &#x3D; vendor;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getOut() &#123;</span><br><span class="line">            return out;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setOut(String out) &#123;</span><br><span class="line">            this.out &#x3D; out;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getCiba_use() &#123;</span><br><span class="line">            return ciba_use;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setCiba_use(String ciba_use) &#123;</span><br><span class="line">            this.ciba_use &#x3D; ciba_use;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public String getCiba_out() &#123;</span><br><span class="line">            return ciba_out;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setCiba_out(String ciba_out) &#123;</span><br><span class="line">            this.ciba_out &#x3D; ciba_out;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public int getErr_no() &#123;</span><br><span class="line">            return err_no;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public void setErr_no(int err_no) &#123;</span><br><span class="line">            this.err_no &#x3D; err_no;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     &#x2F;&#x2F;定义 输出返回数据 的方法</span><br><span class="line">    public void show() &#123;</span><br><span class="line">        Log.d(&quot;翻译：&quot;, content.out );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-创建-用于描述网络请求-的接口"><a href="#3-创建-用于描述网络请求-的接口" class="headerlink" title="3.创建 用于描述网络请求 的接口"></a>3.创建 用于描述网络请求 的接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public class TransApi &#123;</span><br><span class="line">    </span><br><span class="line">    public interface ToTrans &#123;</span><br><span class="line"></span><br><span class="line">        @GET(&quot;ajax.php?a&#x3D;fy&amp;f&#x3D;auto&amp;t&#x3D;auto&amp;w&#x3D;hi%20world&quot;)</span><br><span class="line">        Call&lt;TranslationBean&gt; getCall();</span><br><span class="line">        &#x2F;&#x2F; @GET注解的作用:采用Get方法发送网络请求</span><br><span class="line">        &#x2F;&#x2F; getCall() &#x3D; 接收网络请求数据的方法</span><br><span class="line">        &#x2F;&#x2F; 其中返回类型为Call&lt;*&gt;，*是接收数据的类（即上面定义的TranslationBean类），返回这个类的对象</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-创建-Retrofit-实例"><a href="#4-创建-Retrofit-实例" class="headerlink" title="4.创建 Retrofit 实例"></a>4.创建 Retrofit 实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit &#x3D; new Retrofit.Builder()</span><br><span class="line">                    .baseUrl(&quot;http:&#x2F;&#x2F;fy.iciba.com&#x2F;&quot;) &#x2F;&#x2F;网络请求的url地址</span><br><span class="line">                    .addConverterFactory(GsonConverterFactory.create()) &#x2F;&#x2F;数据解析器，解析json</span><br><span class="line">                    .build();</span><br></pre></td></tr></table></figure>



<h3 id="5-创建-网络请求接口实例"><a href="#5-创建-网络请求接口实例" class="headerlink" title="5.创建 网络请求接口实例"></a>5.创建 网络请求接口实例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 创建 网络请求接口 的实例</span><br><span class="line">      TransApi request &#x3D; retrofit.create(TransApi.class);</span><br><span class="line"></span><br><span class="line">       &#x2F;&#x2F;对 发送请求 进行封装</span><br><span class="line">       Call&lt;TranslationBean&gt; call &#x3D; request.getCall();</span><br></pre></td></tr></table></figure>

<h3 id="6-发送网络请求"><a href="#6-发送网络请求" class="headerlink" title="6.发送网络请求"></a>6.发送网络请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;发送网络请求(异步)</span><br><span class="line">        call.enqueue(new Callback&lt;TranslationBean&gt;() &#123;</span><br><span class="line">            &#x2F;&#x2F;请求成功时回调</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call&lt;TranslationBean&gt; call, Response&lt;TranslationBean&gt; response) &#123;</span><br><span class="line">                &#x2F;&#x2F;请求处理,输出结果</span><br><span class="line">                response.body().show();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;请求失败时候的回调</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call&lt;TranslationBean&gt; call, Throwable throwable) &#123;</span><br><span class="line">                System.out.println(&quot;连接失败&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 发送网络请求（同步）</span><br><span class="line">        try &#123;</span><br><span class="line">            Response&lt;TranslationBean&gt; response &#x3D; call.execute();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-处理返回数据"><a href="#7-处理返回数据" class="headerlink" title="7.处理返回数据"></a>7.处理返回数据</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;发送网络请求(异步)</span><br><span class="line">        call.enqueue(new Callback&lt;TranslationBean&gt;() &#123;</span><br><span class="line">            &#x2F;&#x2F;请求成功时回调</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call&lt;TranslationBean&gt; call, Response&lt;TranslationBean&gt; response) &#123;</span><br><span class="line">                &#x2F;&#x2F;请求处理,输出结果</span><br><span class="line">                response.body().show(); &#x2F;&#x2F;处理返回数据，这里是显示出数据</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;请求失败时候的回调</span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call&lt;TranslationBean&gt; call, Throwable throwable) &#123;</span><br><span class="line">                System.out.println(&quot;连接失败&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="二、网络接口注解类型"><a href="#二、网络接口注解类型" class="headerlink" title="二、网络接口注解类型"></a>二、网络接口注解类型</h2><h4 id="1-请求方法"><a href="#1-请求方法" class="headerlink" title="1.请求方法"></a>1.请求方法</h4><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20201014203753.png" alt="请求方法注解"></p>
<ul>
<li>注解对应着Http的请求方法</li>
</ul>
<blockquote>
<p>@GET  -&gt;  GET</p>
<p>@POST -&gt; POST</p>
<p>@PUT -&gt; PUT</p>
<p>@DELETE -&gt; DELETE</p>
<p>@PATCH -&gt; PATCH</p>
<p>@HEAD -&gt; HEAD</p>
<p>@OPTIONS -&gt; OPTIONS</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;ajax.php?a&#x3D;fy&amp;f&#x3D;auto&amp;t&#x3D;auto&amp;w&#x3D;hi%20world&quot;)</span><br><span class="line">Call&lt;TranslationBean&gt; getCall();</span><br><span class="line">&#x2F;&#x2F; @GET注解的作用:采用Get方法发送网络请求</span><br></pre></td></tr></table></figure>

<h4 id="2-标记类型"><a href="#2-标记类型" class="headerlink" title="2.标记类型"></a>2.标记类型</h4><ul>
<li>@FormUrlEncoded  ——  表示请求体是一个From表单</li>
</ul>
<blockquote>
<p>每个键值对需要用@Filed来注解键名，随后的对象需要提供值</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;&#x2F;form&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getList(@Field(&quot;type&quot;) String type);</span><br></pre></td></tr></table></figure>

<ul>
<li>@Multipart —— 表示请求体是一个支持文件上传的From表单</li>
</ul>
<blockquote>
<p>每个键值对需要用请求参数@Part来注解键名，随后的对象是需要提供值</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Multipart</span><br><span class="line">@POST(&quot;game&#x2F;findgamebinsb&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; gameList(@PartMap Map&lt;String, RequestBody&gt; requestBodyMap);</span><br></pre></td></tr></table></figure>

<ul>
<li>@Streaming —— 表示请求的数据以流的形式返回</li>
</ul>
<blockquote>
<p>注意：若未使用@Streaming注解，默认会把数据全部载入内存，获取数据也是读取内存中的数据，当返回数据较大并且没有使用该注解时，会产生OOM。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Streaming</span><br><span class="line">@GET(&quot;&#x2F;update_apk&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; downloadFile(@Url String fileUrl);</span><br></pre></td></tr></table></figure>

<h4 id="3-请求参数"><a href="#3-请求参数" class="headerlink" title="3.请求参数"></a>3.请求参数</h4><table>
<thead>
<tr>
<th>注解名称</th>
<th>作用</th>
<th>使用位置</th>
</tr>
</thead>
<tbody><tr>
<td>@Headers</td>
<td>用于添加请求头</td>
<td>请求接口的方法上</td>
</tr>
<tr>
<td>@Header</td>
<td>添加不固定值的Header</td>
<td>请求接口的方法参数中</td>
</tr>
<tr>
<td>@Field/@FieldMap</td>
<td>向Post表单中传键值对，与@FormUrlEncoded注解配合使用</td>
<td></td>
</tr>
<tr>
<td>@Part/@PartMap</td>
<td>表单字段，与@Multipart注解配合使用，适合有文件上传的情况</td>
<td></td>
</tr>
<tr>
<td>@Query/@QueryMap</td>
<td>用于表单字段，作用和@Field@FieldMap相同；区别：@Query和@QueryMap中的数据体现在Url上，而@Field和@FieldMap的数据是请求体，但最后生成的数据形式是一样的</td>
<td></td>
</tr>
<tr>
<td>@Body</td>
<td>非表单请求体</td>
<td></td>
</tr>
<tr>
<td>@Path</td>
<td>URL缺省值</td>
<td></td>
</tr>
<tr>
<td>@URL</td>
<td>URL设置</td>
<td></td>
</tr>
</tbody></table>
<hr>
<p>参考自：</p>
<ul>
<li>《Android 进阶之光》</li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a3e162261ab6">Android Retrofit 2.0 的详细 使用攻略（含实例讲解）</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/ezconn/article/details/102692976">Retrofit2的使用及注解分析</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/%E5%8A%A8%E7%94%BB%E6%B7%B1%E5%85%A5%E6%B5%85%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/10/%E5%8A%A8%E7%94%BB%E6%B7%B1%E5%85%A5%E6%B5%85%E6%9E%90/" class="post-title-link" itemprop="url">动画深入浅析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-10 21:46:21" itemprop="dateCreated datePublished" datetime="2020-10-10T21:46:21+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-13 20:18:45" itemprop="dateModified" datetime="2020-10-13T20:18:45+08:00">2020-10-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/10/10/%E5%8A%A8%E7%94%BB%E6%B7%B1%E5%85%A5%E6%B5%85%E6%9E%90/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/10/%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/10/%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97/" class="post-title-link" itemprop="url">四则运算</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-10-10 10:34:32" itemprop="dateCreated datePublished" datetime="2020-10-10T10:34:32+08:00">2020-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-11 12:16:49" itemprop="dateModified" datetime="2020-10-11T12:16:49+08:00">2020-10-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="四则运算"><a href="#四则运算" class="headerlink" title="四则运算"></a>四则运算</h1><table>
<thead>
<tr>
<th align="left">软工作业</th>
<th align="center">结对编程</th>
</tr>
</thead>
<tbody><tr>
<td align="left">作业要求</td>
<td align="center"><a target="_blank" rel="noopener" href="https://edu.cnblogs.com/campus/gdgy/informationsecurity1812/homework/11157">作业</a></td>
</tr>
<tr>
<td align="left">Github</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/Yuki-r/Arithmetic">Github</a></td>
</tr>
<tr>
<td align="left">作业题目</td>
<td align="center">四则运算</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>姓名</th>
<th>学号</th>
</tr>
</thead>
<tbody><tr>
<td>徐潮松</td>
<td>3118005387</td>
</tr>
<tr>
<td>丘美珠</td>
<td>3218005399</td>
</tr>
</tbody></table>
<h2 id="PSP表格"><a href="#PSP表格" class="headerlink" title="PSP表格"></a>PSP表格</h2><table>
<thead>
<tr>
<th align="left">PSP2.1</th>
<th align="left">Pair-programming Process Stages</th>
<th align="left">预估耗时（分钟）</th>
<th align="center">实际耗时（分钟）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Planning</td>
<td align="left">计划</td>
<td align="left">60</td>
<td align="center">100</td>
</tr>
<tr>
<td align="left">Estimate</td>
<td align="left">估计这个任务需要多少时间</td>
<td align="left">300</td>
<td align="center">500</td>
</tr>
<tr>
<td align="left">Development</td>
<td align="left">开发</td>
<td align="left">600</td>
<td align="center">1200</td>
</tr>
<tr>
<td align="left">Analysis</td>
<td align="left">需求分析（包括学习新技术）</td>
<td align="left">120</td>
<td align="center">150</td>
</tr>
<tr>
<td align="left">Design Spec</td>
<td align="left">生成设计文档</td>
<td align="left">60</td>
<td align="center">80</td>
</tr>
<tr>
<td align="left">Design Review</td>
<td align="left">设计复审</td>
<td align="left">20</td>
<td align="center">30</td>
</tr>
<tr>
<td align="left">Coding Standard</td>
<td align="left">代码规范（为目前的开发制定合适的规范）</td>
<td align="left">10</td>
<td align="center">20</td>
</tr>
<tr>
<td align="left">Design</td>
<td align="left">具体设计</td>
<td align="left">50</td>
<td align="center">80</td>
</tr>
<tr>
<td align="left">Coding</td>
<td align="left">具体编码</td>
<td align="left">400</td>
<td align="center">600</td>
</tr>
<tr>
<td align="left">Code Review</td>
<td align="left">代码复审</td>
<td align="left">30</td>
<td align="center">60</td>
</tr>
<tr>
<td align="left">Test</td>
<td align="left">测试（自我测试，修改代码，提交修改）</td>
<td align="left">60</td>
<td align="center">90</td>
</tr>
<tr>
<td align="left">Reporting</td>
<td align="left">报告</td>
<td align="left">30</td>
<td align="center">50</td>
</tr>
<tr>
<td align="left">Test Report</td>
<td align="left">测试报告</td>
<td align="left">60</td>
<td align="center">120</td>
</tr>
<tr>
<td align="left">Size Measurement</td>
<td align="left">计算工作量</td>
<td align="left">60</td>
<td align="center">50</td>
</tr>
<tr>
<td align="left">Postmortem&amp;Process Improvement Plan</td>
<td align="left">事后总结，并提出过程改进计划</td>
<td align="left">30</td>
<td align="center">40</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">合计</td>
<td align="left">1890</td>
<td align="center">3170</td>
</tr>
</tbody></table>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/10/10/%E5%9B%9B%E5%88%99%E8%BF%90%E7%AE%97/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/10/09/%E4%B8%80%E4%B8%AA%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E7%95%8C%E9%9D%A2LoadingViewR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/09/%E4%B8%80%E4%B8%AA%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E7%95%8C%E9%9D%A2LoadingViewR/" class="post-title-link" itemprop="url">一个加载动画界面LoadingViewR</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-09 17:30:41 / 修改时间：17:31:14" itemprop="dateCreated datePublished" datetime="2020-10-09T17:30:41+08:00">2020-10-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/Yuki-r/LoadingView-R">github地址</a></p>
</blockquote>
<h2 id="预览效果"><a href="#预览效果" class="headerlink" title="预览效果"></a>预览效果</h2><p><img src="https://img-blog.csdnimg.cn/img_convert/5deeb5be9076ce814d82ab8c81d0a22d.png"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/10/09/%E4%B8%80%E4%B8%AA%E5%8A%A0%E8%BD%BD%E5%8A%A8%E7%94%BB%E7%95%8C%E9%9D%A2LoadingViewR/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/09/27/View%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/suoda.jpg">
      <meta itemprop="name" content="Yuki">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yuki-r Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/27/View%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/" class="post-title-link" itemprop="url">View的工作原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-27 16:43:59" itemprop="dateCreated datePublished" datetime="2020-09-27T16:43:59+08:00">2020-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-30 22:13:56" itemprop="dateModified" datetime="2020-09-30T22:13:56+08:00">2020-09-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p><img src="https://gitee.com/yuki-r/blog-image/raw/master/img/20200930215951.png" alt="目录"></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/09/27/View%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yuki"
      src="/images/suoda.jpg">
  <p class="site-author-name" itemprop="name">Yuki</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Yuki-r" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Yuki-r" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yuki</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
